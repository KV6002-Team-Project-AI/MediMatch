var __awaiter=this&&this.__awaiter||function(o,t,e,i){function s(o){return o instanceof e?o:new e((function(t){t(o)}))}return new(e||(e=Promise))((function(e,c){function b(o){try{u(i.next(o))}catch(o){c(o)}}function n(o){try{u(i["throw"](o))}catch(o){c(o)}}function u(o){o.done?e(o.value):s(o.value).then(b,n)}u((i=i.apply(o,t||[])).next())}))};var __generator=this&&this.__generator||function(o,t){var e={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},i,s,c,b;return b={next:n(0),throw:n(1),return:n(2)},typeof Symbol==="function"&&(b[Symbol.iterator]=function(){return this}),b;function n(o){return function(t){return u([o,t])}}function u(n){if(i)throw new TypeError("Generator is already executing.");while(b&&(b=0,n[0]&&(e=0)),e)try{if(i=1,s&&(c=n[0]&2?s["return"]:n[0]?s["throw"]||((c=s["return"])&&c.call(s),0):s.next)&&!(c=c.call(s,n[1])).done)return c;if(s=0,c)n=[n[0]&2,c.value];switch(n[0]){case 0:case 1:c=n;break;case 4:e.label++;return{value:n[1],done:false};case 5:e.label++;s=n[1];n=[0];continue;case 7:n=e.ops.pop();e.trys.pop();continue;default:if(!(c=e.trys,c=c.length>0&&c[c.length-1])&&(n[0]===6||n[0]===2)){e=0;continue}if(n[0]===3&&(!c||n[1]>c[0]&&n[1]<c[3])){e.label=n[1];break}if(n[0]===6&&e.label<c[1]){e.label=c[1];c=n;break}if(c&&e.label<c[2]){e.label=c[2];e.ops.push(n);break}if(c[2])e.ops.pop();e.trys.pop();continue}n=t.call(o,e)}catch(o){n=[6,o];s=0}finally{i=c=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:true}}};
/*!
 * Built with Duet Design System
 */import{h,F as Fragment,r as registerInstance,c as createEvent,H as Host,g as getElement}from"./index-909a963e.js";import{i as inheritGlobalTheme}from"./themeable-component-724c0f7e.js";import{d as debounce}from"./js-utils-9b9e0039.js";import{j as isEnterKey,f as isEscapeKey,o as isTabKey,b as isArrowUpKey,c as isArrowDownKey}from"./keyboard-utils-eba88365.js";import{g as getLocaleString,a as getLanguage,c as connectLanguageChangeObserver,d as disconnectLanguageChangeObserver}from"./language-utils-00ca4c55.js";import{p as parsePossibleJSON}from"./string-utils-ca039233.js";var SelectSingle=function(o){var t=o.item,e=o.search,i=e===void 0?"":e,s=o.selected;var c=i!==""?new RegExp("("+i.split(" ").join("|")+")","gi"):undefined;return h(Fragment,null,s&&h("duet-icon",{class:"option-icon",name:"messaging-checked",size:"xx-small",margin:"none"}),c?h("span",{class:"option-container","aria-hidden":"true"},h("span",{innerHTML:t.name.replace(c,'<span class="highlight">$&</span>')})):t.name,t.tags&&h("span",{class:"option-tags"},t.tags.join(", ")))};var DuetComboBoxSelect=function(o){var t=o.item,e=o.active,i=o.total,s=o.selected,c=o.label,b=c===void 0?undefined:c,n=o.clickHandler,u=n===void 0?function(o){o.preventDefault()}:n,r=o.keyHandler,d=r===void 0?function(o){o.preventDefault()}:r,a=o.search;return h("li",{class:{"list-item":true,option:true,active:e,selected:s},id:e?"active_item":"","data-index":t.id,"aria-selected":e?"true":undefined,"aria-current":s?"true":undefined,role:"option","aria-label":b||"".concat(t.name,", (").concat(t.id+1," of ").concat(i,")")},h("a",{tabindex:"-1",onClick:function(o){return u(o)},onKeyUp:function(o){return d(o)},class:"option-link","aria-label":b||"".concat(t.name,", (").concat(t.id+1," of ").concat(i,")"),"aria-hidden":"true"},h(SelectSingle,{item:t,search:a,selected:s})))};var duetComboboxCss='.sc-duet-combobox-h{box-sizing:border-box;padding:0;margin:0;background:transparent;border:0;-moz-appearance:none;-webkit-appearance:none;appearance:none;position:relative;display:inline-block;width:100%;font-family:"localtapiola-sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";color:rgb(0, 41, 77)}.sc-duet-combobox-h a.sc-duet-combobox{color:rgb(0, 41, 77);transition:none}.duet-theme-turva.sc-duet-combobox-h{font-family:"turva-sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";color:rgb(23, 28, 58)}.duet-theme-turva.sc-duet-combobox-h a.sc-duet-combobox{color:rgb(23, 28, 58)}.duet-theme-turva.sc-duet-combobox-h .duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.option.sc-duet-combobox .option-tags.sc-duet-combobox{color:rgb(116, 116, 117)}.duet-theme-turva.sc-duet-combobox-h .duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.option.selected.sc-duet-combobox{background:rgb(244, 207, 214)}.duet-theme-turva.sc-duet-combobox-h .duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.active.sc-duet-combobox,.duet-theme-turva.sc-duet-combobox-h .duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:focus,.duet-theme-turva.sc-duet-combobox-h .duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:hover{color:rgb(255, 255, 255);background:rgb(198, 12, 48)}.duet-theme-turva.sc-duet-combobox-h .duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.active.sc-duet-combobox .option-tags.sc-duet-combobox,.duet-theme-turva.sc-duet-combobox-h .duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:focus .option-tags.sc-duet-combobox,.duet-theme-turva.sc-duet-combobox-h .duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:hover .option-tags.sc-duet-combobox{color:rgb(255, 255, 255)}.duet-theme-turva.sc-duet-combobox-h .duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.active.sc-duet-combobox a.sc-duet-combobox,.duet-theme-turva.sc-duet-combobox-h .duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:focus a.sc-duet-combobox,.duet-theme-turva.sc-duet-combobox-h .duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:hover a.sc-duet-combobox{color:rgb(255, 255, 255)}.duet-combobox-list.sc-duet-combobox{position:absolute;top:calc(100% - 12px);height:0;overflow:hidden;background:rgb(255, 255, 255);border-radius:0 4px;box-shadow:0 2px 10px 0 rgba(0, 41, 77, 0.1);opacity:0}.duet-combobox-list.open.sc-duet-combobox{z-index:700;display:block;height:auto;opacity:1}.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox{max-height:200px;padding:0.75rem 0;margin:0;overflow-y:scroll;font-weight:600;list-style:none;cursor:pointer;scroll-behavior:smooth}.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox{padding:4px 0}.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:not(.selected){padding-left:16px}.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:not(.selected) .highlight.sc-duet-combobox{text-decoration:underline}.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.option.sc-duet-combobox .option-link.sc-duet-combobox{display:block;width:100%}.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.option.sc-duet-combobox .option-tags.sc-duet-combobox{float:right;padding-right:0.875rem;font-weight:400;color:rgb(144, 149, 153)}.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.option-link.sc-duet-combobox{display:block;width:100%}.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.selected.sc-duet-combobox{padding-left:0;background:rgb(205, 229, 241)}.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.selected.option.sc-duet-combobox .option-icon.sc-duet-combobox{padding:0 8px 0 8px}.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.selected.option.sc-duet-combobox .option-tags.sc-duet-combobox{color:rgb(144, 149, 153)}.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.active.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:focus,.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:hover{color:rgb(255, 255, 255);background:rgb(0, 119, 179)}.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.active.sc-duet-combobox .option-tags.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:focus .option-tags.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:hover .option-tags.sc-duet-combobox{color:rgb(255, 255, 255)}.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.active.sc-duet-combobox a.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:focus a.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .duet-combobox-listbox.sc-duet-combobox .list-item.sc-duet-combobox:hover a.sc-duet-combobox{color:rgb(255, 255, 255)}';var DuetCombobox=function(){function o(o){var t=this;registerInstance(this,o);this.duetChange=createEvent(this,"duetChange",3);this.resizeObserver=new ResizeObserver(debounce((function(o){var e,i;if((o===null||o===void 0?void 0:o.length)===1){var s=(i=(e=o[0])===null||e===void 0?void 0:e.target)===null||i===void 0?void 0:i.getBoundingClientRect().width;t.listContainer.style.width="".concat(s+1,"px")}}),100));this.processedItems=null;this.inputWidth=0;this.inputValue="";this.selectionMsg="";this.listOpen=false;this.selectedItems=new Set;this.activeItem=undefined;this.accessibleLabelDefaults={en:{heading:"Select:",item:"{name}, ({current} of {total})",itemFiltered:"{name}, ({current} of {total}, {hiddenItems} filtered)"},fi:{heading:"Valitse:",item:"{name}, ({current}/{total})",itemFiltered:"{name}, ({current}/{total}, {hiddenItems} suodatettu)"},sv:{heading:"Välj:",item:"{name}, ({current} av {total})",itemFiltered:"{name}, ({current} av {total}, {hiddenItems} filtrerade)"}};this.accessibleLabels=getLocaleString(this.accessibleLabelDefaults,getLanguage());this.theme="";this.force=false;this.items=undefined;this.formatter=function(o){return o&&o.name?o.name:""};this.value=undefined;this.minCharacters=1;this.openListOnClick=false;this.filterType="startsWith"}o.prototype.activeItemHandler=function(o){this.input.accessibleActiveDescendant=this.listOpen&&(o||o===0)?"active_item":""};o.prototype.handleDocumentClick=function(o){var t=this;var e=o.composedPath();var i=e.every((function(o){return o!==t.element}));if(i){this.updateInputText(true,true);this.listOpen=false}};o.prototype.formatItem=function(o){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.formatter(o)]}))}))};o.prototype.processItems=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(o){switch(o.label){case 0:this.items=this.processedItems=parsePossibleJSON(this.items);return[4,this.updateInputText()];case 1:o.sent();return[2]}}))}))};o.prototype.processValue=function(){return __awaiter(this,void 0,void 0,(function(){var o;var t=this;return __generator(this,(function(e){if(this.value){o=this.items.find((function(o){return o.value===t.value}));this.updateSelectedItems(o.id)}return[2]}))}))};o.prototype.processListOpenChange=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(o){if(this.openListOnClick){this.input.icon=this.listOpen?"action-arrow-up":"action-arrow-down"}return[2]}))}))};o.prototype.componentWillLoad=function(){inheritGlobalTheme(this)};o.prototype.connectedCallback=function(){var o=this;this.items=this.processedItems=parsePossibleJSON(this.items);this.input=this.element.querySelector("duet-input");this.input.addEventListener("duetChange",this.updateInputValue.bind(this));this.input.addEventListener("click",(function(){if(!o.openListOnClick){o.inputValue.length>=o.minCharacters?o.listOpen=true:o.listOpen=false}else{o.listOpen=!o.listOpen}}));this.element.addEventListener("keydown",this.handleInputKeyDownEvent.bind(this));connectLanguageChangeObserver(this,{prop:"accessibleLabels",defaults:"accessibleLabelDefaults"});this.input.accessibleAutocomplete="list";this.input.accessibleControls="duet-combobox-list-element";this.processListOpenChange()};o.prototype.disconnectedCallback=function(){var o=this;this.input.removeEventListener("duetChange",this.updateInputValue.bind(this));this.input.removeEventListener("click",(function(){return o.inputValue.length?o.listOpen=true:o.listOpen=false}));this.element.removeEventListener("keydown",this.handleInputKeyDownEvent.bind(this));this.listElement.removeEventListener("click",(function(o){o.stopPropagation()}));this.resizeObserver.disconnect();disconnectLanguageChangeObserver(this)};o.prototype.componentDidLoad=function(){this.resizeObserver.observe(this.input);this.listElement.addEventListener("click",(function(o){o.stopPropagation()}));this.processValue()};o.prototype.onListClick=function(o,t){o.preventDefault();this.updateSelectedItems(t.id,true);this.listOpen=false;return this.listOpen};o.prototype.shouldListBeFiltered=function(){var o=this;if(this.selectedItems.size&&this.input.value===this.inputValue){var t=this.items.filter((function(t){return o.selectedItems.has(t.id)}));return!(this.formatter(t).toLowerCase()===this.input.value.toLowerCase())}return true};o.prototype.returnFilteredOrNonFiltered=function(){return this.processedItems?this.shouldListBeFiltered()?this.getFilteredItems():this.sortFilteredItems(this.processedItems):[]};o.prototype.updateSelectedItems=function(o,t){return __awaiter(this,void 0,void 0,(function(){var e;var i=this;return __generator(this,(function(s){switch(s.label){case 0:this.selectedItems.clear();if(this.selectedItems){if(this.selectedItems.has(o)){this.selectedItems.delete(o)}else{this.selectedItems.add(o)}}if(t){e=this.selectedItems.size===0?[]:this.items.filter((function(o){return i.selectedItems.has(o.id)}));this.duetChange.emit({value:e[0].value,item:e[0],component:"duet-combobox"})}return[4,this.updateInputText()];case 1:s.sent();return[2]}}))}))};o.prototype.updateInputText=function(o,t){if(o===void 0){o=false}if(t===void 0){t=false}return __awaiter(this,void 0,void 0,(function(){var e,i;var s=this;return __generator(this,(function(c){switch(c.label){case 0:e=this.selectedItems.size===0?[]:this.items.filter((function(o){return s.selectedItems.has(o.id)}));if(e.length===0&&this.selectedItems.size>0){this.selectedItems.clear();this.input.value="";this.value=undefined;this.activeItem=undefined}if(!(!t&&this.selectedItems.size===1))return[3,2];this.input.value="";i=this.input;return[4,this.formatItem(e[0])];case 1:i.value=c.sent();this.input.scrollLeft=this.input.scrollWidth;this.activeItem=undefined;this.value=e[0].value;c.label=2;case 2:if(o&&this.selectedItems.size===0){if(this.force){this.inputValue="";this.input.value=""}this.activeItem=undefined}this.listOpen=false;return[2]}}))}))};o.prototype.updateInputValue=function(o){var t;this.inputValue=o.detail.value;this.listOpen=String(this.inputValue).length>=this.minCharacters&&((t=this.getFilteredItems())===null||t===void 0?void 0:t.length)>0};o.prototype.handleInputKeyDownEvent=function(o){this.input.accessibleActiveDescendant=undefined;if(isEnterKey(o)){o.preventDefault();this.selectActiveItem();this.updateInputText(false);this.listOpen=false;return}if(isEscapeKey(o)||isTabKey(o)){this.updateInputText(true);this.listOpen=false;return}var t=this.activeItem;if(isArrowUpKey(o)){o.preventDefault();t=this.activeItem-1}else if(isArrowDownKey(o)){o.preventDefault();t=this.listOpen?this.activeItem+1:this.activeItem;this.listOpen=true}if(isArrowDownKey(o)||isArrowUpKey(o)){var e=this.shouldListBeFiltered()?this.getFilteredItems():this.processedItems;if(t<0||!t){t=0}if(t>=e.length){t=e.length-1}this.input.accessibleActiveDescendant="active_item";this.activeItem=t;this.scrollToActive()}this.announceActive();return};o.prototype.selectActiveItem=function(){if(this.activeItem===undefined){return}var o=this.returnFilteredOrNonFiltered();var t=o[this.activeItem];this.updateSelectedItems(t.id,true)};o.prototype.announceActive=function(o){if(!o){o=this.returnFilteredOrNonFiltered()}if(this.activeItem===undefined||this.activeItem===-1){return}var t=o[this.activeItem];this.selectionMsg=structuredClone(this.formatLabel(t,o.length,this.items.length))};o.prototype.scrollToActive=function(){var o=this.listElement.querySelector(".active");if(o){o.scrollIntoView({behavior:"smooth",block:"center"})}};o.prototype.formatLabel=function(o,t,e){if(!o||e===undefined){return""}var i=t===e?this.accessibleLabels.item:this.accessibleLabels.itemFiltered;return i.replace("{name}",String(o.name)).replace("{current}",String(this.activeItem+1)).replace("{total}",String(t)).replace("{hiddenItems}",String(e-t))};o.prototype.getFilteredItems=function(){var o=this;var t=this.processedItems.filter((function(t){var e,i,s,c;return((e=String(t.value))===null||e===void 0?void 0:e.toLowerCase()[o.filterType]((i=o.inputValue)===null||i===void 0?void 0:i.toLowerCase()))||((s=String(t.name))===null||s===void 0?void 0:s.toLowerCase()[o.filterType]((c=o.inputValue)===null||c===void 0?void 0:c.toLowerCase()))||o.selectedItems.has(t.id)}));return this.sortFilteredItems(t)};o.prototype.sortFilteredItems=function(o){var t=this;if(o.length>0){o.filter((function(o){return t.selectedItems.has(o.id)})).forEach((function(t){var e=o.indexOf(t);o.splice(e,1);o.unshift(t)}))}return o};o.prototype.render=function(){var o;var t=this;var e=this.returnFilteredOrNonFiltered();return h(Host,{role:"combobox","aria-expanded":this.listOpen?"true":"false","aria-owns":"duet-combobox-list-element","aria-haspopup":"listbox",class:(o={"duet-combobox":true},o["duet-theme-".concat(this.theme)]=true,o)},h("slot",null),h("div",{class:{"duet-combobox-list":true,open:this.listOpen},ref:function(o){return t.listContainer=o}},h("ul",{class:{"duet-combobox-listbox-open":this.listOpen,"duet-combobox-listbox":true},role:"listbox",ref:function(o){return t.listElement=o},id:"duet-combobox-list-element"},e.map((function(o,i){return h(DuetComboBoxSelect,{item:o,active:i===t.activeItem,selected:t.selectedItems.has(o.id),search:t.inputValue,total:e.length,clickHandler:function(e){return t.onListClick(e,o)},label:t.formatLabel(o,e.length,t.items.length)})})))))};Object.defineProperty(o.prototype,"element",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(o,"watchers",{get:function(){return{activeItem:["activeItemHandler"],items:["processItems"],value:["processValue"],listOpen:["processListOpenChange"]}},enumerable:false,configurable:true});return o}();DuetCombobox.style=duetComboboxCss;export{DuetCombobox as duet_combobox};